(function(d){function m(b,a){for(var c=null;b;){if(b.getAttribute){var e=b.getAttribute("data-navigation");c||b.tagName!==a||"refresh"!==e||(c=b);if("noajax"===e)return null}b=b.parentNode}return c}function l(b,a){n(k,b,!0,a||{})}function n(b,a,c,e,f){b={link:b,data:a,target:e};v("navigating",b,null);c={history:c,title:f?f:d.document.title};f=new d.XMLHttpRequest;f.onreadystatechange=y(f,b,c);f.open(a?"post":"get",h(b,c));a&&f.setRequestHeader("Content-Type","application/json");f.send(d.JSON.stringify(a))}
function h(b,a){var c=b.link,c=c+(0<c.indexOf("?")?"&":"?"),c=c+("refreshajax="+d.encodeURIComponent(k)),c=c+("&navigation="+(a.history?"refresh":"history"));b.target.getAttribute&&(c=g(b.target,c,"include-current"),c=g(b.target,c,"current-keys"),c=g(b.target,c,"to-keys"));return c}function g(b,a,c){(b=b.getAttribute("data-"+c))&&(a+="&"+c.replace("-","")+"="+d.encodeURIComponent(b));return a}function y(b,a,c){var e=k;return function(){if(4===b.readyState)if(200===b.status){var f=d.JSON.parse(b.responseText);
f.Title&&(c.title=f.Title);c.panels=f.Panels;c.link=f.Link;v("navigated",a,c);f.RedirectLink?d.location.href=f.RedirectLink:k===e&&p(a,c)}else v("navigated",a,c)}}function p(b,a){var c={};c.link=k;c.title=d.document.title;c.panels={};v("updating",b,a);if(a.panels){for(var e in a.panels){var f=d.document.getElementById(e);f&&(c.panels[e]=f.innerHTML,f.innerHTML=a.panels[e])}v("updated",b,a);k!==a.link&&(e=a.link,x[k+"&"+e]=a,x[e+"&"+k]=c,-1===q.indexOf(e)&&(r[e]=[],q.push(e)),-1===r[k].indexOf(e)&&
(r[k].push(e),r[e].push(k)),a.history&&d.history.pushState(a.title,a.title,a.link));d.document.title=a.title;k=a.link}}function z(b,a){for(var c={},e={},f=[],d=q.length,g=0;g<q.length;g++)f.push(q[g]),e[q[g]]=d;for(var n=e[b]=0;0!==f.length;){n++;var h=f.sort(function(a,b){return e[a]-e[b]})[0];if(h===a){for(f=[];a;)f.push(a),a=c[a];return f.reverse()}for(var k=r[h],g=0;g<k.length;g++){var l=k[g];e[l]===d&&(e[l]=n,c[l]=h)}f.shift()}return null}function w(b){return function(a){t[b]||(t[b]=[]);t[b].push(a)}}
function v(b,a,c){if(t[b])for(var e=0;e<t[b].length;e++)t[b][e](a,c)}if(d.history&&d.history.pushState){var u={};d.document.addEventListener("click",function(b){var a=b.target,c=m(a,"A");b.ctrlKey||b.shiftKey||!c||(b.preventDefault(),n(c.getAttribute("href"),null,!0,c));"INPUT"!==a.tagName&&"BUTTON"!==a.tagName||!a.name||("submit"===a.type&&(u[a.name]=a.value),"image"===a.type&&(u[a.name+".x"]=d.Math.max(0,b.offsetX),u[a.name+".y"]=d.Math.max(0,b.offsetY)))});d.document.addEventListener("submit",
function(b){var a=m(b.target,"FORM");if(a){b.preventDefault();b=a.getAttribute("action");for(var c=a.elements,e={},f=0;f<c.length;f++){var d=c[f];!A.test(d.tagName)||!d.name||B.test(d.type)||d.disabled||C.test(d.type)&&!d.checked||(e[d.name]=d.value)}for(var g in u)e[g]=u[g];u={};n(b,e,!0,a)}});var A=/^INPUT|TEXTAREA|SELECT$/,B=/^button|image|submit|reset|file$/,C=/^checkbox|radio$/,k=d.location.pathname+d.location.search,r={};r[k]=[];var q=[k],x={};d.addEventListener("popstate",function(b){var a=
d.location.pathname+d.location.search;if(k!==a){var c=z(k,a);if(c)for(b=0;b<c.length-1;b++){var a={link:c[b+1],target:d},e=x[c[b]+"&"+c[b+1]];e.history=null;p(a,e)}else n(a,null,!1,d,b.state)}});var t={};d.refreshAjax={navigate:l,navigating:w("navigating"),navigated:w("navigated"),updating:w("updating"),updated:w("updated")}}})(window);
(function(d){function m(d){l=!1;var h=document.querySelector('#todo-list input[type="text"]');h?(h.focus(),h.value=h.value,h.addEventListener("blur",function(d){l||refreshAjax.navigate({action:"edit",Title:h.value},h.form)}),h.addEventListener("keyup",function(d){l||27!==d.keyCode||refreshAjax.navigate({action:"edit",cancel:!0},h.form)})):"todo-form"===d.target.id&&document.getElementById("new-todo").focus()}if(d.refreshAjax){var l=!1;refreshAjax.navigating(function(d,h){l=d.data&&"edit"===d.data.action});
refreshAjax.updating(function(d,h){if("todo-form"===d.target.id){var g=0,m;for(m in h.panels){var p=Number(m.slice(4));p&&g<p&&(g=p)}g&&!document.getElementById("todo"+g)&&document.getElementById("todo-list").insertAdjacentHTML("beforeend",'<li><span id="todo'+g+'" /></li>')}d.data&&"edit"===d.data.action&&!l&&(h.panels=null)});refreshAjax.updated(function(d,h){if(d.target.getAttribute){var g=d.target.getAttribute("data-todo");g&&!h.panels["todo"+g]&&(g=document.getElementById("todo"+g))&&(g=g.parentNode,
g.parentNode.removeChild(g))}m(d)});m({target:{id:"todo-form"}})}})(window);